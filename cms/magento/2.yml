---
import:
  - recipe/common.php
  - vendor/unleashedtech/deployer-recipes/config.yml
  - vendor/unleashedtech/deployer-recipes/cms/magento/init/app_dir_prefix.php
  - vendor/unleashedtech/deployer-recipes/cms/magento/deploy/assets.php
  - vendor/unleashedtech/deployer-recipes/cms/magento/deploy/assets.php
  - vendor/unleashedtech/deployer-recipes/cms/magento/db/backup/create.php
  - vendor/unleashedtech/deployer-recipes/cms/magento/compile.php
  - vendor/unleashedtech/deployer-recipes/cms/magento/config/import.yml
  - vendor/unleashedtech/deployer-recipes/cms/magento/deploy/assets.php
  - vendor/unleashedtech/deployer-recipes/cms/magento/deploy/vendor.yml
  - vendor/unleashedtech/deployer-recipes/cms/magento/db/upgrade.yml
  - vendor/unleashedtech/deployer-recipes/cms/magento/cache/flush.yml
  - vendor/unleashedtech/deployer-recipes/releases/cleanup.php
  - vendor/unleashedtech/deployer-recipes/db/backup/cleanup.yml
  - vendor/unleashedtech/deployer-recipes/db/backup/download.php

config:
  app_type: magento
  app_directory_name: docroot
  static_content_locals: en_US
  shared_files:
    - app/etc/env.php
    - var/.maintenance.ip
  shared_dirs:
    - var/composer_home
    - var/log
    - var/export
    - var/report
    - var/import
    - var/import_history
    - var/session
    - var/importexport
    - var/backups
    - var/tmp
    - pub/sitemap
    - pub/media
  writable_dirs:
    - var
    - pub/static
    - pub/media
    - generated
  clear_paths:
    - generated
    - pub/static/_cache
    - var/generation
    - var/cache
    - var/page_cache
    - var/view_preprocessed
  mage: 'bin/magento'

tasks:
  deploy:
    - cms:magento:init
    - deploy:prepare
    - deploy:vendors
    - deploy:clear_paths
    - cms:magento:deploy:vendor
    - cms:magento:db:backup:create
    - cms:magento:compile
      #    - cms:magento:deploy:assets
      #    - cms:magento:config:import
      #    - cms:magento:db:upgrade
      #    - cms:magento:cache:flush
    - deploy:publish
      #    - db:backup:cleanup
    - releases:cleanup
    - deploy:unlock
